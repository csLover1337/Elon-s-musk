using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;
namespace WindowsFormsApp2
{
    public partial class Sprite : Form
    {
        public int locX;
        public int locY;
        PuzzlePiece piece;
        int ID;
        bool dragging;
        public int transparency;
        public int layer;
        bool[,] pieceArray = new bool[4, 4];
        bool selected = false;
        bool selected2 = false;
        Rectangle circle;
        public Sprite(int locx, int locy, PuzzlePiece aPiece)
        {
           
            locX = locx;
            locY = locy;
            piece = aPiece;
            pieceArray = piece.getPieceArray();
            
            circle = new Rectangle(locX, locY, 50, 50);
            dragging = false;
            InitializeComponent();
        }




        
        private PictureBox pictureBox1 = new PictureBox();
        Pen red = new Pen(Color.Red);
        Pen blue = new Pen(Color.Blue);
        System.Drawing.SolidBrush fillred = new System.Drawing.SolidBrush(Color.Red);
        Point cursor = Point.Empty;
        



        private void Sprite_Paint_1(object sender, PaintEventArgs e)
        {
            circle.X = locX;
            circle.Y = locY;
            Graphics g = this.CreateGraphics();
            blue.Width = 8.0F;
            for (int i = 0; i < 4; i++)
            {

                for (int j = 0; j < 4; j++)
                {
                    if (pieceArray[i, j])
                    {

                        if ( selected )
                        {
                            g.DrawEllipse(blue, circle);
                        }
                        else
                        {
                            g.DrawEllipse(red, circle);
                        }
                        g.FillEllipse(fillred, circle);
                    }
                    circle.X += 50;
                }
                circle.X -= 200;
                circle.Y += 50;


            }
            circle.X = locX;
            circle.Y = locY;

            


        }
        
        private bool isSelected(int x, int y)
        {
            int locx1 = locX;
            int locy1 = locY;

            for (int i = 0; i < 4; i++)
            {

                for (int j = 0; j < 4; j++)
                {
                    if (pieceArray[i, j])
                    {
                        if (Math.Sqrt((((locx1 + (circle.Width / 2)) - x) * ((locx1 + (circle.Width / 2)) - x)) + (((locy1 + (circle.Width / 2)) - y) * ((locy1 + (circle.Width / 2)) - y))) <= (circle.Width / 2))
                        {
                            if (selected)
                            {
                                selected = false;
                            }
                            else
                            {
                                selected = true;
                            }
                            
                        }
                    }
                    locx1 += 50;
                }
                locx1 -= 200;
                locy1 += 50;

            }


            return selected;
        }
        private void button1_Click(object sender, EventArgs e)
        {
            if (selected)
            {
                piece.rotateRight();
                pieceArray = piece.getPieceArray();
            }
            Refresh();
            pictureBox1.Paint += new System.Windows.Forms.PaintEventHandler(this.Sprite_Paint_1);

            // Add the PictureBox control to the Form.
            this.Controls.Add(pictureBox1);
            
        }

        private void button2_Click(object sender, EventArgs e)
        {
            if (selected)
            {
                piece.rotateLeft();
                pieceArray = piece.getPieceArray();
            }
            Refresh();
            pictureBox1.Paint += new System.Windows.Forms.PaintEventHandler(this.Sprite_Paint_1);

            // Add the PictureBox control to the Form.
            this.Controls.Add(pictureBox1);

        }

       
       
            private void Sprite_Load(object sender, EventArgs e)
        {

        }

        private void Sprite_MouseClick(object sender, MouseEventArgs e)
        {
            
        }

        private void Sprite_MouseMove(object sender, MouseEventArgs e)
        {
            cursor.X = MousePosition.X - this.Location.X;
            cursor.Y = MousePosition.Y - this.Location.Y;

            if (dragging)
            {
                if (selected)
                {
                    locX = cursor.X - 50;
                    locY = cursor.Y - 50;
                }
               
                Refresh();
                pictureBox1.Paint += new System.Windows.Forms.PaintEventHandler(this.Sprite_Paint_1);

                // Add the PictureBox control to the Form.
                this.Controls.Add(pictureBox1);

            }
                
            
            
        }



        private void Sprite_MouseDown(object sender, MouseEventArgs e)
        {
            if (isSelected(e.X, e.Y))
            {
                dragging = true;
            }
        }
        private void Sprite_MouseUp(object sender, MouseEventArgs e)
        {
            dragging = false;
        }

        private void Sprite_DoubleClick(object sender, EventArgs e)
        {
           
        }

        private void Sprite_MouseDoubleClick(object sender, MouseEventArgs e)
        {
            isSelected(e.X, e.Y);
            Refresh();
            pictureBox1.Paint += new System.Windows.Forms.PaintEventHandler(this.Sprite_Paint_1);

            // Add the PictureBox control to the Form.
            this.Controls.Add(pictureBox1);

        }
        

        
    }
}
